syntax = "proto3";

package convhelper.proto.conv.v1;

import "convhelper/proto/uuid/v1/u.proto";
import "google/protobuf/empty.proto";
import "google/protobuf/timestamp.proto";

message ConvertRequest {
  convhelper.proto.uuid.v1.Uuid request_id = 1;
  bytes original = 2;
}

message ConvertResponse {
  bytes converted = 1;
}

service CvtService {
  rpc Convert(ConvertRequest) returns (ConvertResponse);
}

message Src {
  message GetSrcRequest {
    convhelper.proto.uuid.v1.Uuid request_id = 1;
    bytes key = 2;
  }
  message GetSrcResponse {
    bytes val = 1; // original bytes
  }

  message DelSrcRequest {
    convhelper.proto.uuid.v1.Uuid request_id = 1;
    bytes key = 2;
  }
  message DelSrcResponse {
    oneof status {
      google.protobuf.Timestamp removed = 1;
      google.protobuf.Empty absent = 2;
    }
  }
}

service SrcService {
  rpc GetSrc(Src.GetSrcRequest) returns (Src.GetSrcResponse);
  rpc DelSrc(Src.DelSrcRequest) returns (Src.DelSrcResponse);
}

message Ind {
  message ConvManyRequest {
    convhelper.proto.uuid.v1.Uuid request_id = 1;
    repeated bytes keys = 2;
  }

  message ConvManyResponse {
    bytes key = 1;
    bytes converted = 2;
  }
}

service IndirectService {
  rpc ConvMany(Ind.ConvManyRequest) returns (stream Ind.ConvManyResponse);
}
